############################################################################
# RSBE01.txt    												           #
#                        												   #
# Requires GCTRealMate and the source folder provided to assemble the GCT! #
#																		   #
# GCTconvert codes are compatible, if you want to add your own codes, add  #
# them to this txt file, but be mindful of the size of the resulting GCT,  #
# as making it too big will cause it to fail entirely!!!				   #
#																		   #
# If you wish to keep your new codes organized, you can also summon        #
# separate text files by using .include Source/<filename>, 				   #
# or simply add them to there, directly. To disable one, simply place an   #
# exclamation point in front of the name of that code!	 				   #
#                                                                          #
# Enjoy your custom Brawl!!												   #
############################################################################

#############################################################################
######################          Backend Codes          ######################
#############################################################################

.include Source/P+Ex/Hooktype.asm

.include Source/Rex/USBGecko.asm
.include Source/Rex/RAM-EX.asm
.include Source/Project+/MemoryLayout.asm

#############################################################################
AXNextFrame -> VBI Hook Switch After Strap Screen v1.1 [Magus, Sammi-Husky]
#############################################################################
* 20200984 4BE00F24
* 20497ED0 00000001
CODE @ $80001198
{
	addi r6, r7, 0x4C
	mr r3, r7
	addi r4, r7, 0x34
	addi r5, r7, 0x38
}
address $80023D5C @ $80002778
op b -0x1E8184    @ $801E9A2C
op blr	 	  @ $80200984

PULSE
{
	lis r3,0x8020
	ori r3,r3,0x0984
	icbi r0,r3
	lis r3,0x801E
	ori r3,r3,0x9A2C
	icbi r0,r3
	isync
	blr
}

* E2000002 00000000

######################################################
BA and BLA are usable instructions v1.3 [Eon, taukhan]
######################################################
  .po<-flag
32000000 00000001 #if flag != 1
14000000 00000001 #set flag to 1
  .goto->code

flag:
  word 0;
code:
PULSE #80568100
{
  li r3, 0x2
  #virtual address space = 0x00000000
  word 0x7C7383A6   #mtibatl 1, r3  #sets instruction bat lower half
  li r3, 0x1FF
  #physical address space = 0x00000000
  word 0x7C7283A6   #mtibatu 1, r3  #sets instruction bat upper half
  isync 
  blr
}
* E2000001 80008000

############################
Skip Cliff scene intro [Eon]
############################
#jumps straight to playing the OPMovie.thp file from frame 1
CODE @ $806CA25C
{
    lwz r3, 0x388(r31)
    li r4, 18
    li r0, 10
    stw r4, 0x78(r3)
    stw r0, 0x370(r31)
}

#########################################################
Arbitrary Length Opening Movie (OPMovie.THP) [Exul Anima]
#########################################################
op cmpwi r0, 0xC39 @ $806CA354		# Length in frames of portion of OPMovie that you want visible @ 30 FPS. 
# Frames beyond this will not be shown and will only render audio while the title screen shows.

.include Source/Project+/BootToCSS.asm

#############################################################################
Reset multipac stage lock status between Classic & All-Star matches [wiiztec]
#############################################################################
HOOK @ $80044A34
{
	lwz r4, 0x8(r3)
	cmpwi r8, 0x1
	bne- %END%
	lis r12, 0x8059
	stw r15, -0x7D08(r12)
}

###########################################################
Stock/Frame Control not disabled in 300% Mode 1.1 [wiiztec]
###########################################################
op li r0, 0 	@ $806A5C94
op NOP		@ $806844DC

####################################
Special Mode flags clear [wiiztec]
####################################
* 2156369C 41517A00
* 42000000 90000000
* 0217F378 00030000
* E0000000 80008000

###############################
Reflect is Bunny 1.1d [wiiztec]
###############################
HOOK @ $806DF23C
{
	lbz r8, 0x1C(r26)
	cmpwi r8, 0x2
	bne- %END%
	li r8, 0x0
}
HOOK @ $80946954
{
  	lbz r0, 28(r31)
  	lis r12, 0x9017
  	ori r12, r12, 0xF37C
  	lbz r12, 0(r12)
  	cmpwi r12, 0x2
  	bne- %END%
 	mr r11, r0
  	addi r11, r11, 0x8
  	mr r0, r11
}

###############################################
Explodey Items Use Normal Item Limit [Kapedani]
###############################################
op li r3, 1 @ $809b0ec8

############################################
Party Balls Use Normal Item Limit [Kapedani]
############################################
op li r3, 1 @ $809b0e5c

############################################
Bunny Hoods Use Normal Item Limit [Kapedani]
############################################
op li r3, 1 @ $809b0e2c

######################################################
mtRand::randi behaves as mtRand->randi(max) [Kapedani] 
######################################################
op lwz r12, 0xc(r12) @ $8003fb08  # call mtRand->generate() instead of mtRand->randi() in mtRand::randf

HOOK @ $8003fae8 # mtRand::randi
{
    stwu r1, -0x40(r1)
    mflr r0
    stw    r0, 0x44(r1)
    stw    r31, 0x3c(r1)
    mr r31, r4

    lwz r12, 0x0(r3)
    lwz r12, 0xc(r12)
    mtctr r12
    bctrl 

    rlwinm    r0, r3, 24, 8, 31
    lis    r3, 0x4330
    stw    r0, 0x1C(r1)
    xoris    r0, r31, 0x8000
    stw    r3, 0x18(r1)
    lfd    f2, -0x7BC8(r2)
    lfd    f1, 0x18(r1)
    lfs    f0, -0x7BC0(r2)
    fsubs    f2,f1,f2
    stw    r0, 0x24(r1)
    stw    r3, 0x20(r1)
    fdivs    f2,f2,f0
    lfd    f1, -0x7BD0(r2)
    lfd    f0, 0x20(r1)
    fsubs    f0,f0,f1
    fmuls    f0,f0,f2
    fctiwz f0,f0
    stfd f0, 0x28(r1)
    lwz    r3, 0x2C(r1)

    lwz r31, 0x3c(r1)
    lwz    r0, 0x44(r1)
    mtlr r0
    addi r1, r1, 64
    blr
}

#######################################
Ragequit Accelerator [InternetExplorer]
#######################################
op NOP 		@ $800F15D8

###########################################################################################################
Sudden Death Port Fix (Requires Analog C-Stick, L R, & Light-Shield Button Stored as Variables v2.1) [ds22]
###########################################################################################################
op lwz r0, 0x44(r3) @ $8081AD08
op cmplwi r0, 0		@ $8081AD0C
op beq- 0x30		@ $8081AD10

######################################################
1 Player Matches in Time Mode only [InternetExplorer]
######################################################
* C268D420 00000007
* 2C060000 4181000C
* 39000001 48000020
* 2C060002 40800014
* 3D009017 6108F360
* 89080002 48000008
* 39000000 2C080000
* 60000000 00000000
* 0468D424 41820024

############################
1 Team Matches [spunit262]
############################
op li r3, 0 @ $8068D534

#####################################
Online Handicap Disable [spunit262]
#####################################
op nop @ $806F3DA4

#####################################
Training Room Item Fix [ds22]
#####################################
op nop @ $806D1704

################
Infinite Replays
################
op nop @ $800E5DE8
op nop @ $80953184
op nop @ $80953224

###################################################
Allow Pausing When Set to Off v3 [standardtoaster]
###################################################
HOOK @ $800505C8
{
  mfcr r12
  lis r4, 0x8058; ori r4, r4, 0x4084
  cmpwi r3, 0x0;  bne- loc_0x18
  li r3, 0x2
loc_0x18:
  stw r3, 0(r4)
  li r4, 0x8
  mtcr r12
}

##################################################
Match Loss Clears Pause Address [standardtoaster]
##################################################
HOOK @ $808363AC
{
  lis r4, 0x8058
  ori r4, r4, 0x4084
  li r12, 0x0
  stw r12, 0(r4)
  li r4, 0x110
}

#################################################
Match Win Clears Pause Address [standardtoaster]
#################################################
HOOK @ $8083634C
{
  lis r10, 0x8058
  ori r10, r10, 0x4084
  li r4, 0x0
  stw r4, 0(r10)
  mr r5, r31
}

#######################################################################
Pause Set to Off -> Hold Start to Pause v3 [standardtoaster, DukeItOut]
#
# v3: Made hold pause more stable by checking the pause status directly
#######################################################################
HOOK @ $801E6D24
{
	lis r11, 0x8058
	ori r11, r11, 0x4080
	lwz r12, 4(r11)
	cmpwi r12, 0x2		# Todo: Find custom code setting 80584084 and make it just read menu settings
	bne- Finish

	lwz r12, -0x4350(r13)# \
	lwz r12, 0x18(r12)	 # | Get pause status
	lwz r12, 0x3C(r12)	 # /
	cmpwi r12, 1		# If paused, do not rely on hold status. We want to unpause normally!
	beq- Clear			#

	rlwinm. r12, r0, 0, 3, 3
	beq- Clear
	lwzx r12, r11, r4	# \
	cmpwi r12, 50		# | Pause hold timer is 50 frames. If held for that much,
	bge- Finish			# / THEN act like a normal pause.

	addi r12, r12, 0x1	# \ Increment hold timer
	stwx r12, r11, r4	# /
	lis r12, 0x1000		# \ Filter out Start/Pause button
	sub r0, r0, r12		# / Kind of a risky way to do it but probably safe in this context.
	b Finish

Clear:
	li r12, 0x0			# Clear hold timer
	stwx r12, r11, r4	#

Finish:
	stw r0, 0(r30)	# Original operation
}

#############################################
Allow 2x Speed Setting in Training [Magus]
#############################################
* 041058C8 2C1E0006
* 041058E4 3BC00005
* 049629E8 40800008
* C29629F4 00000002
* 3860005A 41820008
* 38600078 00000000

#########################
Unrestricted Pause Camera
#########################
op blr 		@ $800A7D60
op li r4, 1	@ $80109D88

##########################
Unrestricted Replay Camera
##########################
op NOP 		@ $8009E934
op NOP 		@ $8009E93C
op fmr f1, f3	@ $8009E9AC
op fmr f3, f0	@ $8009E9B8
op fmr f0, f1	@ $8009E9BC
op fmr f0, f3	@ $8009E9C8

###################################
[ComboMode+] Default Settings Modifier [Igglyboo, Brkirch, and FMK] https://gamebanana.com/scripts/11460
###################################
* 24494A98 80000000             # 32-Bit If Greater: If Val @ $(ba + 0x00494A98) > 0x80000000
* 20523300 00000000             # 32-Bit If Equal: If Val @ $(ba + 0x00523300) == 0x00000000
* 04523300 DEADBEEF             # 32-Bit Write @ $(ba + 0x00523300):  0xDEADBEEF
* 42000000 90000000             # Set Base Address: ba = 0x90000000
* 0017BE50 00000000             # 8-Bit Write @ $(ba + 0x0017BE50):  0x00
* 0417BE58 000E0000             # 32-Bit Write @ $(ba + 0x0017BE58):  0x000E0000
* 0417BE5C 00000000             # 32-Bit Write @ $(ba + 0x0017BE5C):  0x00000000
* 0417BE74 0420D007             # 32-Bit Write @ $(ba + 0x0017BE74):  0x0420D007
* 0417BE70 00000000             # 32-Bit Write @ $(ba + 0x0017BE70):  0x00000000
* 0417F360 00000108             # 32-Bit Write @ $(ba + 0x0017F360):  0x00000108
* 0417F364 04000A00             # 32-Bit Write @ $(ba + 0x0017F364):  0x04000A00
* 0417F368 08010100             # 32-Bit Write @ $(ba + 0x0017F368):  0x08010100
* 0417F36C 01000000             # 32-Bit Write @ $(ba + 0x0017F36C):  0x01000000
* E0000000 80008000             # Full Terminator: ba = 0x80000000, po = 0x80000000

#################################################
[Legacy TE] Disable Challenger Approaches [ds22]
#################################################
op stw r24, 8(r15) @ $806F5D58

###################################################################
[Legacy TE] CPUs can attack each other in Training Mode [Fracture]
###################################################################
HOOK @ $806F1984
{
	lbz r3, 0xA(r29);
	ori r3, r3, 1
	stb r3, 0xA(r29);
}

################################################################
[Legacy TE] Set the number of CPUs to 0 in Training Mode [Sarrg]
################################################################
op li r31, 0 	@ $80105AC8
op cmpwi r31, 0	@ $80105AD8


###############################################
[Legacy TE] Target Smash levels fix [DukeItOut]
###############################################
HOOK @ $8010F984
{
  	cmplwi r3, 0x33
  	ble+ multiplayer
  	cmplwi r3, 0x39
  	blt- singleplayer
multiplayer:
  	li r29, 0x0	//only forces reset of stages for stable endless friendlies 
	stw r29, 0(r4)	//if actually a multiplayer-stage by design
singleplayer:
  	cmpwi r6, 0x0
}

############################################################
[Legacy TE] Always use PACs instead of PCS files [DukeItOut]
############################################################
op NOP @ $8084CB40

##########################################################################################################################
[Legacy TE] Display Stack Trace, Instruction, and Address Upon Crashing [UnclePunch, Fracture] (internal crash fix by Eon)
##########################################################################################################################
HOOK @ $801D84C8
{
  mflr r0
  stw r0, 4(r1)
  stwu r1, -1280(r1)
  addi r29, r1, 0x8
  mr r3, r29
  addi r4, r28, 0x174
  crclr 6, 6
  lis r12, 0x803F
  ori r12, r12, 0x89FC
  mtctr r12
  bctrl 
  add r29, r29, r3
  lwz r25, 4(r30)
  li r26, 0x0
  b checkValidPointer

printStackTrace:
loc_0x3C:
  lwz r6, 0(r25)
  mr r5, r25
  lwz r7, 4(r25)
  addi r4, r28, 0x19C
  mr r3, r29
  crclr 6, 6
  lis r12, 0x803F
  ori r12, r12, 0x89FC
  mtctr r12
  bctrl 
  add r29, r29, r3
  lwz r25, 0(r25)

checkValidPointer:
  lis r0, 0x8000
  cmplw r25, r0
  blt printInstructionCrash

  lis r0, 0x8180
  cmplw r25, r0
  blt cont

  lis r0, 0x9000
  cmplw r25, r0
  blt printInstructionCrash

  lis r0, 0x9400
  cmplw r25, r0
  bge printInstructionCrash

cont:
#check Has Printed 6 lines
  cmplwi r26, 6
  addi r26, r26, 0x1
  blt+ printStackTrace

printInstructionCrash:
  mr r3, r29
  lis r4, 0x8046
  ori r4, r4, 0x77D8
  lwz r5, 408(r30)
  word 0x7CD302A6 		#`mfdar r6` not supported by gctrm
  lis r12, 0x803F
  ori r12, r12, 0x89FC
  mtctr r12
  bctrl 
  subi r3, r13, 0x592C
  subi r4, r13, 0x5924
  addi r5, r1, 0x8
  lis r12, 0x801D
  ori r12, r12, 0xB7E8
  mtctr r12
  bctrl 
}
op li r7, 0 @ $801dbf60
op li r8, 0 @ $801dbf68

.include Source/P+Ex/EffectsEX.asm

##########################################
Sword Trail Hitlag fix [MarioDox]
##########################################
op nop @ $800659f4 #pauseGroup/[ecTraceMgr]

######################################
Bone Visibility Stabilizer [DukeItOut]
######################################
#
# Prevents a potential hang related
# to trying to set up visibility of
# model parts that do not exist.
#####################################						
HOOK @ $80043DD8
{
	lwz r0, 0xE8(r27)	# \
	addi r3, r1, 8		# | Retrieve bone info
	stw r0, 8(r1)		# /
	bla 0x18EE4C		# Will return bone count
	lwz r5, 0(r31)	# Original operation: The bone switch's bone ID to check for. 
					# It can be a problem if it is higher than the bone count!
	cmplw r3, r5	# Compare the bone to modify with the amount of bones this model has
	bgt+ %END%		# Behave normally if the bone to be modified is present 
	ba 0x043DF4		# Skip process for this check. This model doesn't have the bone to modify!
}

#######################################################################
[Project+] Turbo item does not fire curry shots in any mode [DukeItOut]
#######################################################################
half 0x4800 @ $8083A0A0

####################################################################################################################################
[Project+] Item Frequency None if all items turned off and Items spoofed off if item frequency None (ItemEx Edition) [Eon, Kapedani]
####################################################################################################################################
.macro lwi(<reg>, <val>)
{
    .alias  temp_Hi = <val> / 0x10000
    .alias  temp_Lo = <val> & 0xFFFF
    lis     <reg>, temp_Hi
    ori     <reg>, <reg>, temp_Lo
}

#If all items turned off, save Item frequency as None
HOOK @ $806aa9bc
{
    cmpwi r27, 0
    bne end
  rlwinm. r12,r28,0,13,31 # 0x0007FFFF
    bne end
    li r29, 0
end:
    stb r29, 0(r3)
}
#If Item Frequency None, pretend all items are turned off

#sqVsMelee
HOOK @ $806dcf58
{
    lbz r0, 0x0(r25)
    cmpwi r0, 0
    bne %end%
    stw r0, 0x34(r31)
    stw r0, 0x30(r31)
}
#sqSpMelee
HOOK @ $806def74
{
    lbz r0, 0x0(r29)
    cmpwi r0, 0
    bne %end%
    stw r0, 0x34(r27)
    stw r0, 0x30(r27)
}

#####################################################
Subspace uses same Internal Constants as Versus [Eon]
#####################################################
word 0x0 @ $80B868D8

##############################################
Preloaded Texture memory leak band-aid [Eon]
##############################################
HOOK @ $801f2f40
{
  subi r4, r13, 0x5970
  cmpwi r3, 0
  bne %end%
  lis r12, 0x801f
  ori r12, r12, 0x2f60
  mtctr r12
  bctr
}

HOOK @ $801f3058
{
  mr r31, r3
  cmpwi r3, 0
  bne %end%
  lis r12, 0x801f
  ori r12, r12, 0x30a8E
  mtctr r12
  bctr
}

.include Source/ProjectM/CloneEngine.asm

.include Source/Project+/TripRate.asm
.include Source/Project+/CompressPAC.asm
.include Source/ComboMode+/FilePatchCode.asm
.include Source/P+Ex/WaveIDIntercept.asm
.include Source/Project+/Memory.asm

#############################################################################
######################          Engine Codes          #######################
#############################################################################

#############################################
Shorthop Footstool Multiplier (0.75x) [Magus]
#############################################
HOOK @ $8086B830
{
  stfd f0, 24(r2)
  lis r5, 0x3F40
  stw r5, 16(r2)
  lfs f0, 16(r2)
  fmuls f1, f1, f0
  stfs f1, 36(r1)
  lfd f0, 24(r2)
}

##########################################
Meteor Cancel Delay Subtractor (-4) [ds22]
##########################################
HOOK @ $80856238
{
  lis r10, 0x4080
  stw r10, 0x70(r25)
  lfs f1, 0x70(r25)
  fsubs f0, f0, f1
  stfs f0, 0x6C(r25)
}

##########################################################
Custom Requirements v1.3 (ProjectM) [Magus, Sammi-Husky]
##########################################################
* C27854B0 0000003B
* DBC20010 DBE20018
* 38600001 2C040053
* 408001BC 815C0068
* 812A0074 810A0078
* 80FC0070 80E70020
* 80E7000C 80E70134
* 2C04004D 41820030
* 2C04004E 41820070
* 2C04004F 41820080
* 2C040050 4182008C
* 2C040051 41820094
* 2C040052 41820098
* 48000168 88EA00AE
* 88CA00B0 2C070002
* 4180000C 2C060002
* 40A00150 C3CA0038
* C3EA003C EFDE07B2
* EFFF07F2 EFDEF82A
* 3CE080B8 60E78350
* C3E70000 EFFF07F2
* FC1EF840 40800128
* 48000120 7D264078
* 54C60739 40820118
* 2C070001 41820110
* 48000108 55260739
* 40820104 2C070001
* 408000FC 480000F4
* 7D274078 54E604EB
* 408200EC 480000E4
* 552604EB 408200E0
* 480000D8 806600D8
* 8063001C 81830000
* 818C00F8 7D8903A6
* 4E800421 7C7C1B78
* 2C1C0000 418200B4
* 7F64DB78 38610450
* 3D808078 618C2320
* 7D8903A6 4E800421
* 81810450 38610450
* 818C0014 7D8903A6
* 4E800421 2C030001
* 40820080 81810450
* 38610450 38800000
* 818C0010 7D8903A6
* 4E800421 38000000
* 90610038 9801003C
* 8001003C 90610320
* 90010324 88010324
* 28000001 4082000C
* 38000000 48000008
* A0030006 7F830038
* 7C0300D0 7C001B78
* 54030FFE 2C030001
* 40820020 A005000C
* 80C10524 80C600D8
* 80C60070 88C600A5
* 7C003000 41820008
* 38600000 CBC20010
* CBE20018 60000000
#SDI Input (4D), Any Shield Input (4E-4F), Any Taunt Input (50-51), Specific Hitbox Connects (52)
#Syntax is XXXXYYYY
#X = HitboxID
#Y = Hit Requirement


#############################################################
Bit Variables Beyond 255 and Negative Offset Variables [Magus]
#############################################################
* C27AC9E4 00000003
* 548C0211 5484027E
* 41A20008 7C8400D0
* 60000000 00000000
* C27ACA04 00000003
* 54AC0211 54A5027E
* 41A20008 7CA500D0
* 60000000 00000000
* C27ACB78 00000003
* 54AC0211 54A5027E
* 41A20008 7CA500D0
* 60000000 00000000
* C27ACB98 00000003
* 54AC0211 54A5027E
* 41A20008 7CA500D0
* 60000000 00000000
* C27ACAA0 00000003
* 548C0211 5484027E
* 41A20008 7C8400D0
* 60000000 00000000
* C27ACAC0 00000003
* 548C0211 5484027E
* 41A20008 7C8400D0
* 60000000 00000000
* C27AD114 00000003
* 57CC0211 57C5027E
* 41A20008 7CA500D0
* 60000000 00000000
* C27AD15C 00000003
* 57CC0211 57C5027E
* 41A20008 7CA500D0
* 60000000 00000000
* C27ACBB8 00000003
* 548C0211 5484027E
* 41A20008 7C8400D0
* 60000000 00000000
* C27ACBD8 00000003
* 548C0211 5484027E
* 41A20008 7C8400D0
* 60000000 00000000
* C27ACCA0 00000003
* 548C0211 5484027E
* 41A20008 7C8400D0
* 60000000 00000000
* C27ACCC0 00000003
* 548C0211 5484027E
* 41A20008 7C8400D0
* 60000000 00000000
* C27AD528 00000003
* 57CC0211 57C4027E
* 41A20008 7C8400D0
* 60000000 00000000
* C27AD570 00000003
* 57CC0211 57C4027E
* 41A20008 7C8400D0
* 60000000 00000000
* C27ACCEC 00000003
* 5480027E 7C002E70
* 548C0211 41A20008
* 7C0000D0 00000000
* 047ACCF8 60000000
* C27ACD20 00000003
* 5480027E 7C002E70
* 548C0211 41A20008
* 7C0000D0 00000000
* 047ACD2C 60000000
* C27ACD54 00000003
* 5480027E 7C002E70
* 548C0211 41A20008
* 7C0000D0 00000000
* 047ACD60 60000000

#############################################
Multiply Frame Speed Modifier Command [Magus]
#############################################
HOOK @ $80724820
{
  cmpwi r31, 0x2
  bne+ loc_0x10
  lfs f1, 76(r24)
  fmuls f30, f1, f30
loc_0x10:
  fmr f1, f30
}

######################################
Shieldstun Modifier v2.0 [Magus, ds22]
######################################
HOOK @ $808753FC
{
  stfd f31, 0x10(r2)
  fsubs f31, f31, f1
  lis r4, 0x4036; ori r4, r4, 0xDB70; stw r4, 0x20(r2)	//0x4036D870 = 2.8571434
  lfs f0, 0x20(r2); fmuls f31, f31, f0
  lis r4, 0x408E; ori r4, r4, 0x6666; stw r4, 0x20(r2)	//0x408E6666 = 4.45
  lfs f0, 0x20(r2); fadds f31, f31, f0
  lis r4, 0x3EE5; ori r4, r4, 0x1531; stw r4, 0x20(r2)	//0x3EE51531 = 0.4474273
  lfs f0, 0x20(r2); fmuls f31, f31, f0
  lis r4, 0x4000; stw r4, 0x20(r2)			//0x40000000 = 2.0
  lfs f0, 0x20(r2); fadds f31, f31, f0
  fctiwz f0, f31
  stfd f0, 0x20(r2)
  lwz r28, 0x24(r2)
  lfd f31, 0x10(r2)
}

################################
Defender Shield Pushback [Magus]
################################
HOOK @ $808755AC
{
  stfd f2, 0x10(r2)
  stfd f3, 0x18(r2)
  lis r10, 0x80B8
  ori r10, r10, 0x8464
  lfs f3, 8(r10);  fdivs f2, f30, f3
  lfs f3, 4(r10);  fsubs f2, f2, f3
  lfs f3, 0(r10);  fdivs f2, f2, f3
  lis r12, 0x3E8A; ori r12, r12, 0x3D71; stw r12, 32(r2)
  lfs f3, 32(r2);  fmuls f2, f2, f3
  lis r12, 0x3F99; ori r12, r12, 0x999A; stw r12, 32(r2)
  lfs f3, 32(r2);  fadds f2, f2, f3
  lfs f3, 8(r10);  fmuls f2, f2, f3
  lfs f3, -23460(r2); fcmpo cr0, f2, f3; ble+ loc_0x68
  fmr f2, f3
loc_0x68:
  fmuls f1, f2, f1
  lfd f2, 0x10(r2)
  lfd f3, 0x18(r2)
}

##########################################################################
Powershield Window Doesn't Decrement in Hitlag or 2x Rate in Guard [Magus]
##########################################################################
op b 0x20 	@ $80875164
int 0x20000	@ $80FC2230

##############################################################
Disable Footstool During Paralyze [Dantarion, standardtoaster]
##############################################################
HOOK @ $8083D134
{
  lwz r29, 20(r28)
  lhz r29, 90(r29)
  cmpwi r29, 0xA9	# If in the paralyzer subaction
  bne+ fsOkay		#
  li r3, 0x1		# don't allow footstool.	
fsOkay:
  stb r0, 4(r27)
}

##########################################################################
#No Autosweetspot Ledges v1.3&K [spunit262, Dantarion, Magus, DukeItOut]
#
# v1.2: Cleaned up code
# v1.3: Made an exception for Knuckles' wall climb so it could grab ledges
##########################################################################
HOOK @ $807812B0
{
    cmpwi r4, 0xA; bne+ normal

    lwz r12, 0x28(r1)		#
	cmplwi r12, 0x100		# \ Sometimes input buffer goes through here.
	blt+ normal				# / It's not doing what we expect so this makes it skip that!
	
    lwz r11, 0x110(r12)    # Get the instance ID
    lwz r12, 0x3C(r1)
    cmpwi r11, 0x2D        # Is it Knuckles?
    bne+ notEchidna

    lwz r11, 0x7C(r12)
    lhz r7, 0x3A(r11)
    cmpwi r7, 0x117        # Is Knuckles climbing a wall?
    beq normal             # Let them grab the ledge!

notEchidna:
notWallClimb:    
      lwz r11, 0x18(r12)
      lfs f0, 0x10(r11)
      lfs f1, 0x1C(r11);   fcmpo cr0, f0, f1; bge+ noSweetspot
      fsubs f0, f1, f0
      lfs f1, -0x6A04(r2); fcmpo cr0, f0, f1; bge+ normal
noSweetspot:
      li r0, 0x0
normal:
      rlwinm. r0, r0, 25, 31, 31
}


####################################################
No Air Dodge in tumble [spunit262, Phantom Wings]
####################################################
* C2781310 00000006
* 80980000 2C040021
* 40A20020 8097007C
* 80840034 2C040042
* 41A00010 2C040049
* 41A10008 38600000
* 39610040 00000000

######################################
#Tech Window v0.10 [spunit262, Magus]
######################################
* C277F190 00000011
* 80810010 2C040046
* 41A00078 2C04004C
* 41A10070 80BF0068
* 88C5008F 2C060014
* 40A00060 88E5008E
* 2C070028 41800054
* 2C040049 4182004C
* 41A00008 3884FFFC
* 3884FFBA 5484083C
* 38840060 2C040062
* 4181002C 41820010
* 80C50038 54C66D3E
* 48000010 80C5003C
* 7CC69E70 38C6FFEC
* 2C0607D0 41A00008
* 60840001 90810010
* 60000000 00000000

#######################################
#Melee Air Dodge Angle & Scaling [Magus]
#######################################
HOOK @ $8077F77C
{
 cmpwi r28, 0x21
  bne+ loc_0xA4
  lwz r10, 0x70(r31)
  lwz r10, 0x20(r10)
  lwz r9, 0x18(r10)
  cmpwi r9, 0x4A
  blt- loc_0xA4
  lwz r9, 20(r10)
  lwz r8, 104(r31)
  lfs f1, 56(r8)
  lfs f2, 60(r8)
  lis r7, 0x3FA3
  ori r7, r7, 0xD70A
  stw r7, 16(r2)
  lfs f3, 16(r2)
  fmuls f1, f1, f3
  fmuls f2, f2, f3
  fmuls f3, f1, f1
  fmuls f4, f2, f2
  fadds f3, f3, f4
  word 0xFC601834 # fsqrte f3, f3  # TODO: fix fsqrte f3, f3 in GCTRM
  lfs f4, -23464(r2)
  fcmpo cr0, f3, f4
  bge- loc_0x9C
  fmuls f1, f1, f3
  fmuls f2, f2, f3
  fcmpo cr0, f1, f4
  ble+ loc_0x74
  fmr f1, f4

loc_0x74:
  fcmpo cr0, f2, f4
  ble+ loc_0x80
  fmr f2, f4

loc_0x80:
  lfs f4, -23452(r2)
  fcmpo cr0, f1, f4
  bge+ loc_0x90
  fmr f1, f4

loc_0x90:
  fcmpo cr0, f2, f4
  bge+ loc_0x9C
  fmr f2, f4

loc_0x9C:
  stfs f1, 0xB0(r9)
  stfs f2, 0xB4(r9)

loc_0xA4:
  lwz r3, 0x44(r30)
}


################################################
Momentum Capture v4.4 [Phantom wings, spunit262]
################################################
HOOK @ $808669D8
{
  lwz r4, 0x70(r29)
  lwz r4, 0x20(r4)
  lwz r4, 0x0C(r4)
  lwz r4, 0x2D0(r4)
  lwz r4, 0x4(r4)
  lwz r4, 0x30(r4)
  b loc_0x20

loc_0x1C:
  li r4, 0xFFFF

loc_0x20:
  lwz r3, 124(r29)
  lhz r7, 6(r3)
  lwz r3, 56(r3)
  cmpwi r3, 0xB
  bne+ loc_0x74
  lis r0, 0x4540
  stw r0, 12(r27)
  lfs f2, 12(r27)
  subi r5, r2, 0x1554

loc_0x44:
  lwzu r6, 4(r5)
  srawi. r0, r6, 24
  blt- loc_0x58
  cmpw r0, r4
  bne+ loc_0x44

loc_0x58:
  rlwinm r0, r6, 0, 9, 31
  xoris r0, r0, 17728
  stw r0, 12(r27)
  lfs f0, 12(r27)
  fsub f0, f0, f2
  lfs f1, 8(r27)
  fmul f1, f1, f0

loc_0x74:
  cmpwi r3, 0x22
  blt- loc_0x8C
  cmpwi r4, 0x2F
  bne+ loc_0x90
  cmpwi r7, 0x112
  blt+ loc_0x90

loc_0x8C:
  stfs f1, 8(r27)

loc_0x90:
}
HOOK @ $8077F794
{
  lwz r0, 0x34(r30)
  sth r0, 6(r30)
  lwz r0, 0x48(r30)
}

######################################################################
DamageFlyRoll Animation is Based on KB Instead of Total Damage [Magus]
######################################################################
HOOK @ $8076E0F0
{
  lis r12, 0x4387
  stw r12, 0x10(r2)
  lfs f0, 0x10(r2)
  fcmpo cr0, f28, f0
}

################################################
Electric Element Uses Normal Hitlag Type [Magus]
################################################
op nop @ $8076D254
op nop @ $808761C8

###############################################################
Attacker Never has Electric Hitlag [Dantarion, Standardtoaster]
###############################################################
op b 0x6C @ $8076E228

######################################################
Disable Vertical Boost on Tumble KB [Dantarion, Magus]
######################################################
op lfs	f2, -0x72C0 (r30) @ $8086DBDC

#################################################################################################
Reset Variables on Action Changes & RCO Lag Fix v2 [standardtoaster, ds22, Magus, DukeItOut, Eon]
#################################################################################################
.alias action = 28
.alias situation = 29
HOOK @ $8077F780
{
  #isFighter()
  lwz r3, 0x8(r31)
  lwz r12, 0x3C(r3)
  lwz r12, 0xA4(r12)
  mtctr r12 
  bctrl 
  cmpwi r3, 0
  bne end #not 0 = not a fighter 
checkOne:

  #getSituationKind = getGrounded state, 0 = grounded, 1 = air
  lwz r3, 0xD8(r31)
  lwz r3, 0x14(r3)
  lwz r12, 0x0(r3)
  lwz r12, 0x14(r12)
  mtctr r12 
  bctrl 
  mr situation, r3
  cmpwi action, 0x19; beq checkTwo 
  cmpwi action, 0xE; blt checkGrounded 
  cmpwi action, 0x10; ble checkTwo
  cmpwi action, 0x112; blt checkGrounded
  cmpwi action, 0x115; ble saveOne
checkGrounded:
  cmpwi situation, 0; bne checkTwo #if not grounded 
saveOne:
  lwz r3, 0xD8(r31)
  lwz r3, 0x64(r3)
  lis r4, 0x1100
  fsubs f1, f1, f1
  lwz r12, 0x0(r3)
  lwz r12, 0x3C(r12)
  mtctr r12 
  bctrl #set LA-Float[0] = 0.0 #landing lag count

checkTwo: 
  cmpwi situation, 0x0;  beq setLedgeGrab #if grounded 
  cmpwi action, 0xBD;  bne notDead #if not in death animation
death:
  lwz r3, 0xD8(r31)
  lwz r3, 0x64(r3)
  li r4, 0
  lis r5, 0x1000
  addi r5, r5, 81
  lwz r12, 0x0(r3)
  lwz r12, 0x1C(r12)
  mtctr r12 
  bctrl #set LA-Basic[81] = 0 #agt count
  b setLedgeGrab

notDead:
  cmpwi action, 0x44;  bne end #if not GroundedHitstun end 

setLedgeGrab:  
  lwz r3, 0xD8(r31)
  lwz r3, 0x64(r3)
  li r4, 0
  lis r5, 0x1000
  addi r5, r5, 79
  lwz r12, 0x0(r3)
  lwz r12, 0x1C(r12)
  mtctr r12 
  bctrl #set LA-Basic[79] = 0, ledgegrab count
end:
  stw r28, 0x38(r30) # Set Action
  li r29, 1
  lwz r3, 0x44(r30)
}

##################################################################
Tether Limit is 1 for Zair and 2 for others V1.2 [standardtoaster]
##################################################################
HOOK @ $808E9470
{
  lwz r7, 96(r25)
  lwz r7, 124(r7)
  lhz r7, 6(r7)
  cmpwi r7, 0x82
  ble- loc_0x1C
  cmpwi r3, 0x2
  b %END%

loc_0x1C:
  cmpwi r3, 0x1
}

#######################
Melee 361 Angle [Magus]
#######################
float 44.0 @ $80B87ABC
float 32.0 @ $80B87AC0
float 32.1 @ $80B87AC4

##################################################################
Weight Independent Knockback and Forced Tumble on Throws [Magus]
##################################################################
HOOK @ $80769EA0
{
	lbzx r0, r3, r0
	lwz r10, 52(r24)
	cmpw r10, r27
	bgt+ 0x2C
	li r0, 0x0
	lbz r10, 36(r27)
	cmpwi r10, 0xBF
	bne+ 0x1C
	lwz r10, 60(r23)
	lwz r9, 112(r10)
	lwz r9, 36(r9)
	lwz r9, 12(r9)
	li r8, 0x2329
	stw r8, 4(r9)
 }
 
##########################################################
[Project+] Can Grab Characters Slightly Behind [DukeItOut]
##########################################################
HOOK @ $80756984
{
    fmuls f0, f1, f0     # original operation
    lis r3, 0xC0D0       # \
    stw r3, -0x4(r1)     # | -6.5 units maximum behind
    lfs f31, -0x4(r1)    # /
}


################################################
Shield Break Minimum Disabled Time Fix [Magus]
################################################
HOOK @ $80875D40
{
	fcmpo cr0, f31, f1
	bge+ 0x8
	fmr f31, f1
	fcmpo cr0, f1, f1
}

#######################################################
Outside Damage Grab Break Uses Current Hit Only [Magus]
#######################################################
op stfs	f1, 0x0028 (r29) @ $807712C8

#################################################
Item Throw XY Velocity are Scaled Equally [Magus]
#################################################
HOOK @ $809C1868
{
	lfs f3, 224(r28)
	fmuls f3, f3, f1
	stfs f3, 224(r28)
	lfs f3, 4(r31)
}

#############################################
Slopes do not Affect Landing Velocity [Magus]
#############################################
op fneg	f2,f2 	@ $80794634
op fmr	f0,f2 	@ $8079463C

######################################################################
Traction 2x on Non-Dash Character Momentum > Max Walking Speed [Magus]
######################################################################
* C2794D3C 00000010
* 3C808100 60840000
* 7C1A2000 41800060
* 3C808170 60840000
* 7C1A2000 41810050
* 809A004C 7C04F000
* 40820044 809A001C
* 808400D0 C0040024
* FC201A10 FC000840
* 4082002C C0240020
* C01E0008 FC000210
* FC000840 40810018
* C01E0008 EC23182A
* EC00082A C03E000C
* 48000010 C01E0008
* C03E000C EC00182A
* 60000000 00000000

################################################################
Dash Exit into Wait, Dash, and Taunt Keep Full Velocity [Magus]
################################################################
* C284FFA4 0000000D
* 9421FFF0 BFC10008
* 7FE802A6 3FC08085
* 63DE5C9C 7C1FF000
* 40820040 3FC080B8
* 63DEB33C 7C03F000
* 40A20030 2C1C0000
* 41820018 2C1C0003
* 41820010 2C1C010C
* 41820008 48000014
* 3FE03F80 93E20010
* C0220010 48000008
* C023CF54 BBC10008
* 38210010 00000000

####################################################
Guard On Momentum Limit Attribute is Ignored [Magus]
####################################################
HOOK @ $8086CF44
{
	lfs f2, 8(r1)
	fmr f1, f2
	fabs f1, f1
	fneg f3, f1
}

###########################################
Powershield Reflect Sets Variable [Magus]
###########################################
* C2840820 0000000D
* 3D808180 80830060
* 7C046000 40800050
* 80A4007C 7C056000
* 40800044 A0A50036
* 2C05001A 41800038
* 2C05001D 41810030
* 80C40070 7C066000
* 40800024 80C60024
* 7C066000 40800018
* 80C6001C 7C066000
* 4080000C 38E00004
* 98E60002 80630060
* 60000000 00000000

################################################
GuardOn Animations Allow In Transition [Magus]
################################################
* C2874B34 00000006
* 819B007C A18C0036
* 2C0C001A 40A20018
* 819B0014 818C0040
* 3D604080 7C0C5800
* 41800008 4E800421
* 60000000 00000000

#############################################################
Jump Direction Determined Last Frame of Jump Squat [Magus]
#############################################################
* C286BBB8 00000008
* 3CA09019 60A5A158
* DBE50000 C0230010
* 809E0018 C3E40040
* EC2107F2 FC200850
* 809E0070 80840020
* 80840014 D0240018
* C0230010 CBE50000
* EFFF0072 00000000
* 04FADD18 11000006

#########################################
#Melee Character Pushing Mechanics [Magus]
#########################################
float 0.3 @ $80F9FF0C
float 0.0 @ $80F9FF10

#############################################################
Dream Land Wind Uses TopN-X for Collision Detection [Magus]
#############################################################
* C2041D68 00000007
* C0040000 3D208001
* 61291044 7D4802A6
* 7C095000 40A2001C
* 3CE03D8F 60E75C29
* 810309FC 7C074000
* 40A20008 C004FFF4
* 60000000 00000000
* C2041D98 00000004
* C0040008 7C095000
* 40A20010 7C074000
* 40A20008 C004FFF4
* 60000000 00000000

#############################################################
KO Ownership Timer doesn't Trigger on Certain Actions [Magus]
#############################################################
HOOK @ $8083C320
{
  cmpwi r25, 0x4A;  beq- 0x14	# Hitting the ground in tumble
  cmpwi r25, 0x60;  beq- 0xC	# Teching the ground
  cmpwi r25, 0x61;  bne+ 0x10	# Tech roll
  li r3, 0xFFFF
  cmpwi r3, 0xFFFF; b 0x8
  cmpwi r0, 0xFFFF
}

#####################
Momentum Capture Data
#####################
CODE @ $805A7DD0
{
    fcmpu	cr6,f0,f2
}

############################################
#Hitstun Modifier [Phantom Wings, spunit262] 
############################################
* 02B88F48 00030001
#* 04B87AA8 3ECCCCCD # Hitstun mult written by code menu, so disabled here

##########################################
Tripping Rate is 0 V3.1 [Kapedani]
##########################################
* op stfs f1, 0x04D0(r3) @ $8081bd54
* op lfs f1, -0x4BBC(r31) @ $809a9a44

##################################################
Triple Jump Glitch Fix [Phantom Wings, spunit262]
##################################################
op addi	r4, r3, 3 @ $80858DCC

######################################################################
#[Project+] Wiggle out of Tumble Window extended to 2 frames [Fracture]
######################################################################
int 2 @ $80B88F64

#######################################################
[Project+] Left-Facing Crawl Momentum Fix [Sammi Husky]
#######################################################
op fdivs f1, f0, f31 @ $80873B54

#######################################################
[Project+] Glancing Blow Threshold is Zero [Magus, Eon]
#######################################################
float 0.0 @ $80AD7204

######################################################
Don't drop fighter generated items when hit [Kapedani]
######################################################
.alias BaseItem__getCreaterItem             = 0x8099302c
.alias g_ftEntryManager                     = 0x80B87c48
.alias ftEntryManager__getEntryIdFromTaskId = 0x80823f90

.macro lwd(<reg>, <addr>)
{
    .alias  temp_Lo = <addr> & 0xFFFF
    .alias  temp_Hi_ = <addr> / 0x10000
    .alias  temp_r = temp_Lo / 0x8000
    .alias  temp_Hi = temp_Hi_ + temp_r
    lis     <reg>, temp_Hi
    lwz     <reg>, temp_Lo(<reg>)
}
.macro lwi(<reg>, <val>)
{
    .alias  temp_Hi = <val> / 0x10000
    .alias  temp_Lo = <val> & 0xFFFF
    lis     <reg>, temp_Hi
    ori     <reg>, <reg>, temp_Lo
}
.macro call(<addr>)
{
  %lwi(r12, <addr>)
  mtctr r12
  bctrl    
}
.macro branch(<addr>)
{
    %lwi(r12, <addr>)
    mtctr r12
    bctr
}

HOOK @ $808411ac   ## Fighter::dropItemCheck
{
  addi r4, r1, 0x34   # \
  li r5, 0            # |
  lwz r3, 0xd8(r30)   # |
  lwz r3, 0xa8(r3)    # | moduleAccesser->enumerationStart->itemManageModule->getHaveItem(&soItemInfo, 0)
  lwz r12, 0x0(r3)    # | 
  lwz r12, 0x5C(r12)  # |
  mtctr r12           # |
  bctrl               # /
  lwz r3, 0x38(r1)   # itemInfo.baseItem
isItem:
  stw r3, 0x38(r1)  # itemInfo.baseItem = item
  %call (BaseItem__getCreaterItem)
  cmpwi r3, 0x0 
  bne+ isItem
  lwz r3, 0x38(r1)   # \
  lwz r4, 0x8C8(r3)  # / itemInfo.baseItem->emitterTaskId
  %lwd (r3, g_ftEntryManager)                     # \
  li r5, 0                                        # |
  %call (ftEntryManager__getEntryIdFromTaskId)    # | Check if emitterTaskId belongs to a fighter
  cmpwi r3, 0                                     # |
  blt+ dropItem                                   # /
noDropItem:
  %branch (0x808412f4)
dropItem:
  lwz    r3, 0x00D8 (r30)  # Original operation
}

##################################################
#[Project+] Rolls Don't Cancel Knockback [Fracture]
##################################################
op NOP @ $80885020 

################################################
#[Project+] Character Ledge Unsnap fix [Fracture]
################################################
int 0x20000 @ $80FC2AB0
int 0x20000 @ $80FC2AB8

##########################################################
[Project+] Angle 365 negative y speed capped at -0.5 [Eon]
##########################################################
HOOK @ $80869AB0
{
  lis r19, 0xBF00		# \ 
  stw r19, 0xC(r29)		# | load a value of -0.5
  lfs f1, 0xC(r29)		# /
  fcmpo cr0, f0, f1		# \
  bgt- notTooFast		# | if f0 is more negative than -0.5, then force it to be -0.5
  fmr f0, f1			# /
notTooFast:
  stfs f2, 0x190(r1)		# original operation
}

##################################################
[Project+] Disable Screen-KOs in teams [ds22, Eon]
##################################################
HOOK @ $8087C310
{
  lis r15, 0x80b8
  lwz r15, 0x7C28(r15)
  lwz r15, 0x6E(r15)
  andi. r15, r15, 0x8
  beq normalCheck
  #if items enabled = casuals, dont enable
  lis r15, 0x805A
  lwz r15, 0xE0(r15)
  lwz r15, 0x08(r15)
  lbz r15, 0x16(r15)
  cmpwi r15, 0
  bne normalCheck

  lis r15, 0x9018
  addi r15, r15, 0xB73
  lbz r15, 0(r15)
  cmpwi r15, 0x1;  beq- forceStarKO
normalCheck:
  cmpw r3, r26;  b %END%

forceStarKO:
  li r15, 0x0
  cmpwi r15, 0x1
}

######################################
#[Project+] Melee Tech Rolls [Fracture]
######################################

float 1.0 @ $80B883B8 #tech roll knockback multiplier (default of 0.1)

HOOK @ $8089DBD0
{
  lwz r3, 0xD8(r30)
  lwz r3, 0x70(r3)
  lwz r3, 0x34(r3)
  cmpwi r3, 0x61; beq dontSlideoff 	#techRoll  
  cmpwi r3, 0x1E; beq dontSlideOffLater #spotdodge
  cmpwi r3, 0x1F; beq dontSlideOffLater #rollF
  cmpwi r3, 0x20; beq dontSlideOffLater #rollB

slideoff:
  li r3, 1
  b %end%
  
dontSlideOffLater:
  lwz r3, 0xD8(r30)
  lwz r3, 0x8(r3)
  addi r3, r3, 60
  lwz r3, 0x4(r3)
  lis r4, 0x3F80
  cmpw r3, r4
  beq slideoff

dontSlideoff:
  li r3, 0x0

}

#############################################################
[Project+] Player Can Drift if Hitstun Ends Prematurely [Eon]
#############################################################
HOOK @ $808674f4
{
_start:
	lwz r8, 8(r5)
	cmpwi r8, 0xA1
	blt _AllowDrift    #if action less than any hitstun action, allow drift
	cmpwi r8, 0xA9
	bgt _AllowDrift    #if action greater than any hitstun action, allow drift 
	b _end
_AllowDrift:
	li r3, 0           #result of comparison is ble'd, so 0 is loaded in to force result to be true
_end:
	cmpwi r3, 0
}

###############################################################################################################
[Project+] Customizable Attacker Hitlag Modifier [DukeItOut]
#
# Place value 48495421 into RA-Basic[10] to eliminate hitlag for the attacker
# Place value 48495478 into RA-Basic[10] to make the scalar in RA-Basic[12] be an additional multiplier
# 	for the attacker's hitlag
# Place value 6869743A into RA-Basic[10] to make the value in RA-Basic[12] be the attacker's hitlag
###############################################################################################################
HOOK @ $8083FFBC
{
	lwz r3, 0x60(r3)		# Original operation
	lwz r6, 0x70(r3)		# \
	lwz r6, 0x24(r6)		# | Access RA-Basics
	lwz r6, 0xC(r6)			# / 
	lwz r5, 40(r6)			# We want RA-Basic[10] 	(10*4 = 40)
	lis r12, 0x4849			# \ "HIT!" (48495421)
	ori r12, r12, 0x5421		# /
	cmpw r5, r12			# If that's what the ASCII in RA-Basic[10] says . . . .
	beq- NoHitlag			# Then there will be no hitlag!
	lis r12, 0x4849			# \ "HITx" (48495478)
	ori r12, r12, 0x5478		# /
	cmpw r5, r12
	beq- MultiplyHitlag
	lis r12, 0x6869			# \ "hit:" (6869743A)
	ori r12, r12, 0x743A		# /
	cmpw r5, r12
	bne+ %END%
SetHitlag:
	lwz r4, 48(r6)			# Access RA-Basic[12] (12*4 = 48)
	b ModifiedHitlag
MultiplyHitlag:
	lwz r5, 48(r6)			# \ Access RA-Basic[12] (12*4 = 48)
	mullw r4, r4, r5		# / and multiply the current hitlag by it
	li r5, 0			# \
	ori r5, r5, 60000		# | Scalars are really just ints * 60000			
	divw r4, r4, r5			# / Convert back into an int!
ModifiedHitlag:
	cmpw r4, 0			# \
	bge- %END%			# / Safety to prevent people trying to force negative hitlag
NoHitlag:
	li r4, 0			# No frames of hitlag!
}

############################################################
Defender Electric Hitlag disabled by 2.0x trip chance [Eon]
############################################################
HOOK @ $8076E410
{
	lwz r3, 0x60(r4) 	#load hitbox triprate
	lis r4, 0x4000		#load 2.0 into r26
	cmpw r3,r4 		#compare
	beq _force 		#if equal, pretend not electric hitlag
	cmplwi r0,3 		#original compare, check for electric type
	b _end
_force:
	cmpwi r4,0 		#always not equal
_end:
}

####################################################
Expand Classic mode horde battle costume array [Eon]
####################################################
#increase stack
op stwu r1, -0x100(r1) @ $806e0bc8
op stw r0, 0x104(r1) @ $806E0BD0
op lwz r0, 0x104(r1) @ $806e13e4
op addi r1, r1, 0x100 @ $806e13ec
#move array from offset 0x8 to offset 0xA0, changing size from 16 costumes to 96 costumes
op addi r5, r1, 0xA0 @ $806e0ef0
op addi r4, r1, 0xA0 @ $806e0f34
op addi r15, r1, 0xA0 @ $806E0F5C
op addi r5, r1, 0xA0 @ $806E0FCC

########################################################
Change Subaction Pass Frame also Passes FSM v 1.1 [Eon]
########################################################
HOOK @ $80724224
{
    fmr f31, f1

    #getRate
    lwz r12, 0x0(r24)
    mr r3, r24
    lwz r12, 0x20(r12)
    mtctr r12
    bctrl 
    fsubs f0, f1, f1
    fcmpo cr0, f1, f0
    ble %end% #if new speed <= 0, don't pass it
    #set as passed frame speed 
    fmr f30, f1
} 

####################################################################
changeMaterialTex returns if getResTex returned a null pointer [Eon]
####################################################################
hook @ $800b72a0
{
    cmpwi r3, 0
    bne end
    lis r12, 0x800b
    ori r12, r12, 0x73f4
    mtctr r12 
    bctr
end:
   stw r3, 0x44(r1)
}

#######################
Tags in replays [Y.S]
#######################
op li r5, 0 @ $8004B140

###################################
Lagless Character Selection [Magus]
###################################
op fcmpo cr0, f0, f0 @ $8069D424

###########################################
Reset Tag when Unplugged [standardtoaster]
###########################################
HOOK @ $80695264
{
	stw r0, 0x1C8(r28) 
	lwz r3, 0x1E4(r28)
}

######################################################################
Japanese character support in name maker [Dantarion, standardtoaster]
######################################################################
CODE @ $80674534
{
	addi r4, r28, 0
	li r5, 0x14
	bl -0x670204
	li r0, 0x5
}
int[6] 2, 4, 0, 1, 3, 0 @ $8067B790

#######################################
Allow disabled names [standardtoaster]
#######################################
op b 0xC @ $8069B82C
op NOP   @ $806781E4

#####################################
Existing Tag Usage [standardtoaster]
#####################################
op mr r19, r3 @ $8069B868

################################################################################
[Legacy TE] sc_selmap.pac can be 3 times larger because I said so V2 [DukeItOut]
#
# V2: Altered code to be more flexible and stable
################################################################################
HOOK @ $806BF22C
{
  sub r5, r0, r3
  lis r12, 0x12;   ori r12, r12, 0x8760;  cmplw r3, r12;   bne- finish	# Expected file size
checkIfMenuResource:
  lwz r12, 0x20(r27); lwz r0, 0xC(r12)	# Get the memory size of the heap being used
  lis r12, 0x8042; lwz r12, 0x2384(r12)	# Get the memory size of MenuResource
  cmpw r0, r12; bne finish		# Check if they match
  subis r5, r5, 0x20			# Shift back 0x200000
finish:
  lbz r0, 0x1C(r27); rlwinm. r0, r0, 26, 31, 31	# Reset cache condition check
}

#########################################################################################
[Legacy TE] Hold L/R to inc/dec 1/4 of a character's costume count on the CSS [DukeItOut]
#########################################################################################
op sub r26, r26, r3 	@ $8069A274
op add r26, r26, r3 	@ $8069A384
op b 0x8		@ $8069BE34
HOOK @ $8069BE30
{
  	lis r27, 0x8069
  	ori r27, r27, 0xBE38
  	lwz r29, 8(r1)
  	andi. r3, r29, 0x60	// if either L (40) or R (20) are held
  	li r3, 0x0
  	beq- notSoFast
  	li r3, 0x1		// initiate the status to allow rapid scrolling
notSoFast:
  	stw r3, 0(r27)		// which is stored at 8069BE38
  	lwz r29, 20(r1)
  	and r3, r29, r0
  	lwz r27, 12(r1)
  	neg r0, r3
}
HOOK @ $8069A37C
{
  	lis r6, 0x8069
  	ori r6, r6, 0xBE38
  	lwz r6, 0(r6)
  	cmplwi r6, 1
  	beq- hastyScroll
  	subic. r26, r26, 0x1
  	b %END%
hastyScroll:
  	li r6, 0x4	
 	divw r6, r3, r6		// jump rate = 1/r6 * total
  	subc. r26, r26, r6
}
HOOK @ $8069A268
{
  	lis r6, 0x8069
  	ori r6, r6, 0xBE38
  	lwz r6, 0(r6)
  	cmplwi r6, 1
  	beq- hastyScroll
  	addi r26, r26, 0x1
  	b %END%
hastyScroll:
  	li r6, 0x4	
  	divw r6, r3, r6		// jump rate = 1/r6 * total
  	add r26, r26, r6
}

.include Source/LegacyTE/Masquerade.asm
.include Source/LegacyTE/CSSCustomControls.asm

###################################
Team Colour Shade Check Fix (BrawlEx) [ds22, Sammi Husky]
###################################
* C26D5BE0 00000002
* 7C7F1B78 7D6C5B78
* 60000000 00000000
* C26D5C08 00000003
* 2C03000D 4082000C
* 2C1F000D 41820008
* 7C0C5800 00000000
* C2952B0C 00000002
* 7C6B1B78 7C640214
* 60000000 00000000

#########################################
SFX Fade Fix PMEXv0.5 [ds22, PyotrLuzhin]
#########################################
* C21C7574 00000004
* 2C1A2431 41800010
* 2C1A26F8 41810008
* 38000005 901F0000
* 60000000 00000000

.include Source/Project+/CSE.asm
.include Source/Project+/ResultsMusic.asm
.include Source/Project+/SFXExpand.asm

#############################################################################
################          Character-Specific Codes          #################
#############################################################################

###############################################################
[Legacy TE] Peach costumes no longer use a FitEntry [DukeItOut]
###############################################################
uint8_t 0x0 @ $80AD803C

.include Source/Project+/YoshiEggs.asm

##################################################################
Squirtle Side-B Footstool Uses Normal Requirement 0x2713 [Magus]
##################################################################
* 048590C8 48000024
* 0489F010 48000090

#############################################################
Pokemon Trainer Infinite Stamina [Phantom Wings, spunit262]
#############################################################
op nop @ $80A8BDAC

####################################################################
PT Pokemon Have Final Smashes & FS Characters Don't v1.1 [ds22, Eon]
####################################################################
#minor edit to remove random change in register use and tidy up a little

#set pointers for 4 chars functions
* 04B060DC 8081DF8C
* 04B060E4 8081DF8C
* 04B060EC 8081DF8C
* 04B06114 8081DF84

* 0481DF14 809D0008
* 0481DF18 3804FFFD
op li r0, 236 @ $8081DF84

word 0x17171717 @ $80AD8BB4

HOOK @ $8081DF6C
{
  li r0, 92
  lwz r3, 0x8(r29)
  cmpwi r3, 45
  bne %end%
  li r0, 124
}

#######################################################
Independent Pokemon Engine HTP, Classic & MMS [ds22]
#######################################################
* C26DDDF4 00000006
* 2C03001D 40A20008
* 3860001E 2C03001F
* 40A20008 38600020
* 2C030021 40A20008
* 38600022 987D0098
* 60000000 00000000
* C26E1178 00000006
* 2C12001D 40A20008
* 3A40001E 2C12001F
* 40A20008 3A400020
* 2C120021 40A20008
* 3A400022 9A550098
* 60000000 00000000
* C295E184 00000006
* 2C1F001D 40A20008
* 3BE0001E 2C1F001F
* 40A20008 3BE00020
* 2C1F0021 40A20008
* 3BE00022 9BE30000
* 60000000 00000000

#######################################################################
Independent Pokemon Save Data Engine + no wreck My Music v2 [spunit262]
#######################################################################
* 06407BD0 0000000E
* 04030F0D 1E1B1F1B
* 201B211B 221B0000

#####################
Unload PT Data [ds22]
#####################
word[24] 0x1D, 0x1E, 0x1F, 0x1C, 0x1D, -1, -1, -1, |
         0x1E, 0x1F, 0x1D, 0x1C, 0x1E, -1, -1, -1, |
         0x1F, 0x1D, 0x1E, 0x1C, 0x1F, -1, -1, -1, |
@ $80AD8428

################################
ZSS Jumbo Screen Name Fix [ds22]
################################
op li r23, 0x17 @ $80985F44 //0x17 is ZSS ID, instead of the normal 0x3 for Samus
op li r30, 0x17 @ $8098652C 

#################################
[Project+] Roy Counter Fix [ds22] 
#################################
HOOK @ $808A1058
{
  cmpwi r3, 0x27;  beq- loc_0x10
  li r3, 0x0;  b %END%
loc_0x10:
  li r3, 0x1
}

#######################################################
Snake's U-Smash can Have Horizontal Velocity [Magus]
#######################################################
* C28E6FA0 00000004
* 81830068 2C0C2329
* 4082000C C003006C
* 48000008 C0049560
* 60000000 00000000

.include Source/Project+/EffectCommands.asm
.include Source/Project+/Attributes.asm

.include Source/Project+/CStick.asm

.include Source/Community/Syringe.asm
.include Source/Project+/MultiGCT.asm